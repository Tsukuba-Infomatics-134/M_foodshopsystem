<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ¡é™°ç¥­2025 é£Ÿè²©å‘¼ã³å‡ºã—çŠ¶æ³ç¢ºèª</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        padding: 40px 20px;
      }
      h1 {
        font-size: 2em;
        margin-bottom: 0.2em;
      }
      h2 {
        font-size: 1.2em;
        font-weight: normal;
        margin-bottom: 2em;
      }
      input {
        font-size: 1.2em;
        padding: 15px;
        width: 80%;
        max-width: 350px;
        border: 2px solid black;
        border-radius: 10px;
        margin-bottom: 30px;
        box-sizing: border-box;
        text-align: center;
      }
      button {
        font-size: 1em;
        padding: 12px 40px;
        border: none;
        border-radius: 8px;
        background-color: #dcdcdc;
        cursor: pointer;
      }
      button:hover {
        background-color: #bfbfbf;
      }
      body {
        font-family: sans-serif;
        text-align: center;
        padding: 20px;
      }
      h1 {
        font-size: 2em;
        margin-bottom: 0.2em;
      }
      h2 {
        font-size: 1.2em;
        font-weight: normal;
        margin-bottom: 1em;
      }
      .store {
        font-size: 1.2em;
        color: #4169e1;
        margin-bottom: 2em;
      }
      .label {
        font-size: 1.2em;
        margin-top: 1.5em;
        margin-bottom: 0.3em;
      }
      .orderNum {
        font-size: 5em;
        font-weight: bold;
        color: #4169e1;
        margin: 0.2em 0 1em 0;
      }
      .status {
        font-size: 1.5em;
        font-weight: bold;
        margin-bottom: 2em;
      }
      .order {
        font-size: 1.2em;
        margin-bottom: 1em;
      }
      .items {
        text-align: left;
        display: inline-block;
        font-size: 1.1em;
        line-height: 1.8;
      }
    </style>
  </head>
  <body>
    <div id="root">
      <h1>æ¡é™°ç¥­2025</h1>
      <h2>é£Ÿè²©å‘¼ã³å‡ºã—çŠ¶æ³ç¢ºèªãƒšãƒ¼ã‚¸</h2>
      <form>
        <input type="text" placeholder="æ³¨æ–‡ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" />
        <br />
        <button type="submit">é€ä¿¡</button>
      </form>
    </div>
    <div id="status">
      <h1>æ¡é™°ç¥­2025</h1>
      <h2>é£Ÿè²©å‘¼ã³å‡ºã—çŠ¶æ³ç¢ºèªãƒšãƒ¼ã‚¸</h2>
      <div class="store">æ¡é Œå €ã€€ï¼ˆ2çµ„ï¼‰</div>
      <button id="reload-btn">å†èª­ã¿è¾¼ã¿</button>
      <div class="ordertext">å—ä»˜ç•ªå·</div>
      <div class="orderNum">123</div>

      <div class="label">å‘¼ã³å‡ºã—çŠ¶æ³</div>
      <div class="status">ã¾ã ã§ã™</div>

      <div class="label">æ³¨æ–‡å†…å®¹</div>
      <div class="items">
        ãƒ—ãƒ¬ãƒ¼ãƒ³ï¼š1å€‹<br />
        ãƒãƒ¼ã‚ºã€€ï¼š0å€‹
      </div>
      <div class="label">æœ€çµ‚æ›´æ–°æ—¥æ™‚</div>
      <div id="last-updated" style="font-size: 1em; margin-bottom: 2em"></div>
    </div>
  </body>
  <script>
    const apiurl_production = "https://api.yaakiyu.f5.si/";
    const apiurl_dev = "http://localhost:80/";
    let apiurl = apiurl_production;

    // devã‚µãƒ¼ãƒãƒ¼ãŒç”Ÿãã¦ã„ã‚Œã°apiurlã‚’devã«åˆ‡ã‚Šæ›¿ãˆã‚‹
    function tryDevApiUrlSwitch() {
      fetch(apiurl_dev + "version", { method: "GET", cache: "no-store" })
        .then((res) => {
          if (res.ok) {
            apiurl = apiurl_dev;
            console.warn("apiurlã‚’é–‹ç™ºç’°å¢ƒã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ");
          }
        })
        .catch(() => {
          // devã‚µãƒ¼ãƒãƒ¼ãŒè½ã¡ã¦ã„ã‚‹å ´åˆã¯ä½•ã‚‚ã—ãªã„
        });
    }
    tryDevApiUrlSwitch();

    const classDatas = [
      {}, // ç®¡ç†è€…ç”¨
      {
        // 1çµ„
        store: "ãƒ™ãƒ“ã‚«ã‚¹ã®ç„¼ãæ–¹",
        variety: 2,
        title: ["ãƒ™ãƒ“ãƒ¼ã‚«ã‚¹ãƒ†ãƒ©(ãƒ—ãƒ¬ãƒ¼ãƒ³)", "ãƒ™ãƒ“ãƒ¼ã‚«ã‚¹ãƒ†ãƒ©(æŠ¹èŒ¶)"],
        explain: ["ãŸã ã®ãƒ™ãƒ“ã‚«ã‚¹", "å°‘ã—é•ã†ãƒ™ãƒ“ã‚«ã‚¹"],
        picture: ["", ""],
        price: [100, 100],
        limit: 10,
        bgimage:
          "https://illust.download/wp-content/uploads/2017/11/background134.jpg",
      },
      {
        // 2çµ„
        store: "æ¡é Œå €",
        variety: 2,
        title: ["ãŠå¥½ã¿ç„¼ã(ãƒ—ãƒ¬ãƒ¼ãƒ³)", "ãŠå¥½ã¿ç„¼ã(ãƒãƒ¼ã‚ºå…¥ã‚Š)"],
        explain: ["ãŸã ã®ãŠå¥½ã¿ç„¼ã", "å°‘ã—é»„è‰²ã„ãŠå¥½ã¿ç„¼ã"],
        picture: ["", ""],
        price: [100, 100],
        limit: 10,
        bgimage:
          "https://illust.download/wp-content/uploads/2017/11/background137.jpg",
      },

      {
        // 3çµ„
        store: "ã ã‚“ã”3-3å…„å¼Ÿ",
        variety: 2,
        title: ["ã¿ãŸã‚‰ã—ããªã“å›£å­", "ã‚«ãƒ©ãƒ•ãƒ«ã‚ã‚“ã“å›£å­"],
        explain: ["ã¿ãŸã‚‰ã— (ããªã“ãƒˆãƒƒãƒ”ãƒ³ã‚°å¯èƒ½)", "ã‚ã‚“ã“"],
        picture: ["", ""],
        price: [100, 100],
        limit: 10,
        bgimage:
          "https://illust.download/wp-content/uploads/2017/11/background135.jpg",
      },
      {
        // 4çµ„
        store: "ã‚‚ã‚Šã¦ã¤ãƒ•ãƒ­ãƒ¼ã‚ºãƒ³ãƒ‘ãƒ©ãƒ€ã‚¤ã‚¹",
        variety: 2,
        title: ["ã‹ãæ°·(æŠ¹èŒ¶ç™½ç‰å°è±†)", "ã‹ãæ°·(ãƒãƒ³ã‚´ãƒ¼)"],
        explain: ["æŠ¹èŒ¶å‘³ã§ç™½ç‰ã¨å°è±†ãŒã‚ã‚‹ã‚„ã¤", "ãƒãƒ³ã‚´ãƒ¼å‘³"],
        picture: ["", ""],
        price: [100, 100],
        limit: 10,
        bgimage:
          "https://illust.download/wp-content/uploads/2017/11/background138.jpg",
      },
      {
        // 5çµ„
        store: "ã˜ã‚ƒãŒã„ã‚‚ã ã‘ã˜ã‚ƒã ã‚ã§ã™ã‹",
        variety: 2,
        title: [
          "ã‚·ãƒ£ã‚«ã‚·ãƒ£ã‚«ãƒãƒ†ãƒˆ(ã‚³ãƒ³ã‚½ãƒ¡)",
          "ã‚·ãƒ£ã‚«ã‚·ãƒ£ã‚«ãƒãƒ†ãƒˆ(ãƒã‚¿ãƒ¼é†¤æ²¹)",
        ],
        explain: ["ã†ã¾ã„", "ã†ã¾ã„"],
        picture: ["", ""],
        price: [200, 200],
        limit: 10,
        bgimage:
          "https://illust.download/wp-content/uploads/2017/11/background136.jpg",
      },

      {
        // 6çµ„
        store: "ã²ã£ã±ã‚Šã ã“",
        variety: 2,
        title: ["ãŸã“ç„¼ã", "ãŸã“ç„¼ã(æ˜å¤ªã‚‚ã¡ãƒãƒ¼ã‚º)"],
        explain: ["é€šå¸¸", "çªç„¶å¤‰ç•°"],
        picture: ["", ""],
        price: [100, 100],
        limit: 10,
        bgimage:
          "https://illust.download/wp-content/uploads/2017/11/background133.jpg",
      },
    ];

    function sendRequest() {
      const params = new URLSearchParams(window.location.search);
      const orderNum = parseInt(params.get("order") || "", 0);
      const password_ = parseInt(params.get("pw") || "", 0);
      fetch(apiurl + "mobile/get_order/" + orderNum, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          password: password_,
        },
      })
        .then(async (response) => {
          if (response.status === 200) {
            return response.json();
          } else if(response.status===404){
            console.error("Error:", response.text());
            alert("æ³¨æ–‡ç•ªå·ãŒé–“é•ã£ã¦ã„ã¾ã™");
            return null;
          } else if(response.status===403){
            console.error("Error:", response.text());
            alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™");
            return null;
          }
        })
        .then((data) => {
          if (data) {
            console.log("Success:", data);
            // åº—åãƒ»ç•ªå·ãƒ»çŠ¶æ³ã‚’åæ˜ 
            document.querySelector(".store").innerText =
              classDatas[data["user"]].store;
            document.querySelector(".orderNum").innerText = data["id"];
            document.querySelector(".status").innerText = data["status"];
            if(data["status"]==="å‘¼ã³å‡ºã—å¾…ã¡"){
              //Todo:å¾…ã¡äººæ•°è¡¨ç¤º data["wait_number"]
            }
            else if(data["status"]==="ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿"){
              
            }
            else{
              //elseã§ç¹‹ã„ã§ã„ã‚‹ãŒã€ä»–ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¯¾å¿œã™ã‚‹ã«ã¯ãã¡ã‚“ã¨å…¨éƒ¨åˆ—æŒ™ã—ãŸã»ã†ãŒã‚ˆã„
              document.querySelector(".status").innerText = "å‘¼ã³å‡ºã—ä¸­";
            }

            // æ³¨æ–‡å†…å®¹ã‚’çµ„ã¿ç«‹ã¦ã¦åæ˜ 
            let itemsHtml = "";
            itemsHtml += `${classDatas[data["user"]].title[0]}ï¼š${
              data["order_items"]["item_1"]
            }å€‹<br/>`;
            itemsHtml += `${classDatas[data["user"]].title[1]}ï¼š${
              data["order_items"]["item_2"]
            }å€‹<br/>`;

            document.querySelector(".items").innerHTML = itemsHtml;
          } else {
            return;
          }
        });
      console.log(orderNum, password_, "ç•ªç›®ã®æ³¨æ–‡ã‚’ç¢ºèªã—ã¾ã™");
    }
    function hashchanged(hash) {
      const now = Date.now();
      const lastRequestTime = parseInt(localStorage.getItem("pre_time") || "0");
      document.getElementById("last-updated").innerText = new Date(
        lastRequestTime
      ).toLocaleString("ja-JP", { hour12: false });
      if (now - lastRequestTime < 10000) {
        //ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«å‰å›ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ®‹ã—ã¦ãŠã„ã¦ã€ãã‚Œã‚’è¡¨ç¤ºã™ã‚‹
        console.log(lastRequestTime);
        console.log(now - lastRequestTime);
        console.log("Toooooooo many request");
        document.getElementById("root").style.display = "none";
        document.getElementById("status").style.display = "block";
        return;
      }
      localStorage.setItem("pre_time", now);
      document.getElementById("last-updated").innerText = new Date(
        now
      ).toLocaleString("ja-JP", { hour12: false });
      document.getElementsByClassName("orderNum")[0].innerText =
        location.hash.substring(1);
      if (location.hash.substring(1) != "" || true) {
        sendRequest(location.hash.substring(1));
        document.getElementById("root").style.display = "none";
        document.getElementById("status").style.display = "block";
      } else {
        document.getElementById("root").style.display = "block";
        document.getElementById("status").style.display = "none";
      }
    }
    window.addEventListener("hashchange", () => {
      hashchanged();
    });
    window.addEventListener("DOMContentLoaded", () => {
      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸå€¤ã‚’è¡¨ç¤º
      hashchanged();

      // ğŸ”½ å†èª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³å‡¦ç†
      document.getElementById("reload-btn").addEventListener("click", () => {
        console.log("å†èª­ã¿è¾¼ã¿");
        hashchanged();
      });
    });
  </script>
</html>
